<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BookPoint \u2014 Chapter-wise Main Points (Auto Categories)</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: dark;
        }

        html,
        body {
            height: 100%;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        dialog::backdrop {
            background: rgba(2, 6, 23, 0.72);
            backdrop-filter: blur(6px);
        }

        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.35) transparent;
        }

        .scrollbar::-webkit-scrollbar {
            height: 10px;
            width: 10px;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.35);
            border-radius: 999px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-100">
    <div class="min-h-full"> <!-- Top bar -->
        <header class="sticky top-0 z-40 border-b border-slate-800/70 bg-slate-950/75 backdrop-blur">
            <div class="mx-auto flex max-w-7xl items-center justify-between gap-3 px-4 py-3">
                <div class="flex items-center gap-3"> <button id="btnToggleSidebar"
                        class="md:hidden inline-flex items-center justify-center rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">
                        Menu </button>
                    <div class="flex items-center gap-2">
                        <div
                            class="grid h-9 w-9 place-items-center rounded-xl bg-gradient-to-br from-indigo-500 to-fuchsia-500 font-bold">
                            BP</div>
                        <div class="leading-tight">
                            <div class="text-base font-semibold">BookPoint</div>
                            <div class="text-xs text-slate-300">Book main points \u2022 Chapter-wise \u2022 Auto
                                categories</div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2"> <button id="btnExport"
                        class="hidden sm:inline-flex items-center justify-center rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">Export
                        JSON</button> <button id="btnImport"
                        class="hidden sm:inline-flex items-center justify-center rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">Import</button>
                    <button id="btnReset"
                        class="inline-flex items-center justify-center rounded-lg border border-rose-900/70 bg-rose-950/40 px-3 py-2 text-sm font-medium text-rose-100 hover:bg-rose-950/70">Reset</button>
                </div>
            </div>
        </header>
        <main class="mx-auto grid max-w-7xl grid-cols-1 gap-4 px-4 py-4 md:grid-cols-12"> <!-- Sidebar -->
            <aside id="sidebar" class="md:col-span-4 lg:col-span-3">
                <div class="rounded-2xl border border-slate-800 bg-slate-900/40">
                    <div class="flex items-center justify-between border-b border-slate-800 px-4 py-3">
                        <div>
                            <div class="text-sm font-semibold">Library</div>
                            <div class="text-xs text-slate-300">Data localStorage me save hota hai</div>
                        </div> <span id="statTotal" class="rounded-full bg-slate-800 px-2 py-1 text-xs text-slate-200">0
                            points</span>
                    </div>
                    <div class="p-4">
                        <div class="mb-3"> <label class="text-xs font-medium text-slate-300">Quick Search</label> <input
                                id="sidebarSearch" placeholder="book / chapter / point"
                                class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2" />
                        </div>
                        <div class="mb-4">
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-semibold text-slate-300">Books</div> <button id="btnClearBook"
                                    class="text-xs text-slate-400 hover:text-slate-200">Clear</button>
                            </div>
                            <div id="bookList" class="mt-2 max-h-48 space-y-1 overflow-auto pr-1 scrollbar"></div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <div class="text-xs font-semibold text-slate-300">Categories</div> <button
                                    id="btnClearCategory"
                                    class="text-xs text-slate-400 hover:text-slate-200">Clear</button>
                            </div>
                            <div id="categoryList" class="mt-2 max-h-56 space-y-1 overflow-auto pr-1 scrollbar"></div>
                        </div>
                    </div>
                    <div class="border-t border-slate-800 p-4">
                        <div class="rounded-xl bg-slate-950/40 p-3">
                            <div class="text-xs font-semibold">Tip</div>
                            <div class="mt-1 text-xs text-slate-300">Aap sirf <span
                                    class="text-slate-100 font-medium">book + chapter + main point</span> likhein.
                                Category auto suggest ho jayegi. Baad me filter karke review karein.</div>
                            <div class="mt-2 text-[11px] text-slate-400">Export/Import se aap apna data backup bhi rakh
                                sakte hain.</div>
                        </div>
                    </div>
                </div>
            </aside> <!-- Main content -->
            <section class="md:col-span-8 lg:col-span-9"> <!-- Add form -->
                <div class="rounded-2xl border border-slate-800 bg-slate-900/40">
                    <div class="border-b border-slate-800 px-4 py-3">
                        <div class="flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
                            <div>
                                <div class="text-sm font-semibold">Add Main Point</div>
                                <div class="text-xs text-slate-300">Kitab ka chapter-wise main point note karein</div>
                            </div>
                            <div class="text-xs text-slate-400">Suggested category: <span id="suggestedCategory"
                                    class="font-semibold text-slate-200">General</span></div>
                        </div>
                    </div>
                    <form id="addForm" class="grid grid-cols-1 gap-3 p-4 md:grid-cols-12">
                        <div class="md:col-span-5"> <label class="text-xs font-medium text-slate-300">Book name
                                (Kitab)</label> <input id="inpBook" required placeholder="e.g., How to Talk to Anyone"
                                class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2" />
                        </div>
                        <div class="md:col-span-4"> <label class="text-xs font-medium text-slate-300">Chapter</label>
                            <input id="inpChapter" placeholder="e.g., Chapter 3: First impression"
                                class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2" />
                        </div>
                        <div class="md:col-span-3"> <label class="text-xs font-medium text-slate-300">Category</label>
                            <div class="mt-1 flex items-center gap-2"> <select id="selCategory"
                                    class="w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2"></select>
                            </div> <label class="mt-2 inline-flex items-center gap-2 text-xs text-slate-300"> <input
                                    id="chkAuto" type="checkbox" class="h-4 w-4 accent-indigo-500" checked /> Auto
                                categorize </label>
                        </div>
                        <div class="md:col-span-12"> <label class="text-xs font-medium text-slate-300">Main point /
                                note</label> <textarea id="inpPoint" required rows="3"
                                placeholder="Write the key idea in your own words\u2026"
                                class="mt-1 w-full resize-y rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2"></textarea>
                            <div class="mt-2 flex flex-wrap items-center justify-between gap-2">
                                <div class="text-xs text-slate-400">Shortcut: <span
                                        class="font-semibold text-slate-200">Ctrl/\u2318 + Enter</span> to save</div>
                                <div class="flex items-center gap-2"> <button type="button" id="btnDemo"
                                        class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">Add
                                        demo</button> <button
                                        class="rounded-lg bg-indigo-500 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-400">Save
                                        point</button> </div>
                            </div>
                        </div>
                    </form>
                </div> <!-- Toolbar -->
                <div class="mt-4 rounded-2xl border border-slate-800 bg-slate-900/40">
                    <div class="grid grid-cols-1 gap-3 p-4 md:grid-cols-12">
                        <div class="md:col-span-5"> <label class="text-xs font-medium text-slate-300">Search</label>
                            <input id="mainSearch" placeholder="search in points\u2026"
                                class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2" />
                        </div>
                        <div class="md:col-span-3"> <label class="text-xs font-medium text-slate-300">Group view</label>
                            <select id="selGrouping"
                                class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2">
                                <option value="bookChapter">Book \u2192 Chapter</option>
                                <option value="flat">Flat list</option>
                            </select> </div>
                        <div class="md:col-span-2"> <label class="text-xs font-medium text-slate-300">Sort</label>
                            <select id="selSort"
                                class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2">
                                <option value="new">Newest</option>
                                <option value="old">Oldest</option>
                                <option value="book">Book A\u2192Z</option>
                            </select> </div>
                        <div class="md:col-span-2 flex items-end justify-between gap-2"> <button id="btnCopySummary"
                                class="w-full rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">Copy
                                Summary</button> </div>
                    </div>
                </div> <!-- Notes + summary -->
                <div class="mt-4 grid grid-cols-1 gap-4 lg:grid-cols-12">
                    <div class="lg:col-span-8">
                        <div class="rounded-2xl border border-slate-800 bg-slate-900/40">
                            <div class="flex items-center justify-between border-b border-slate-800 px-4 py-3">
                                <div>
                                    <div class="text-sm font-semibold">Your Points</div>
                                    <div id="activeFilters" class="text-xs text-slate-300">No filters</div>
                                </div>
                                <div class="flex items-center gap-2"> <button id="btnClearAllFilters"
                                        class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">Clear
                                        filters</button> </div>
                            </div>
                            <div id="notesContainer" class="max-h-[60vh] overflow-auto p-4 scrollbar"></div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="rounded-2xl border border-slate-800 bg-slate-900/40">
                            <div class="border-b border-slate-800 px-4 py-3">
                                <div class="text-sm font-semibold">Book Insights</div>
                                <div class="text-xs text-slate-300">Selected book ka chapter-wise breakdown</div>
                            </div>
                            <div id="insights" class="p-4">
                                <div class="text-sm text-slate-300">Kisi book ko sidebar se select karo to yahan
                                    chapters aur summary \u0646\u0638\u0631 \u0622\u0626\u06d2 \u06af\u06cc.</div>
                            </div>
                        </div>
                        <div class="mt-4 rounded-2xl border border-slate-800 bg-slate-900/40">
                            <div class="border-b border-slate-800 px-4 py-3">
                                <div class="text-sm font-semibold">Backup</div>
                                <div class="text-xs text-slate-300">Export / Import JSON</div>
                            </div>
                            <div class="p-4 space-y-2"> <button id="btnExport2"
                                    class="w-full rounded-lg bg-indigo-500 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-400">Export
                                    JSON</button> <button id="btnImport2"
                                    class="w-full rounded-lg border border-slate-800 bg-slate-900 px-4 py-2 text-sm font-semibold hover:bg-slate-800">Import
                                    JSON</button>
                                <div class="text-[11px] text-slate-400">Import se pehle apna backup bana lena best hai.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <footer class="mt-6 pb-10 text-center text-xs text-slate-500">
                    <div>Built for self-improvement reading notes. Everything stays in your browser (localStorage).
                    </div>
                </footer>
            </section>
        </main>
    </div> <!-- Hidden file input for import --> <input id="fileImport" type="file" accept="application/json"
        class="hidden" /> <!-- Edit dialog -->
    <dialog id="editDialog" class="w-[min(720px,92vw)] rounded-2xl border border-slate-700 bg-slate-950 text-slate-100">
        <form id="editForm" method="dialog" class="p-4">
            <div class="flex items-start justify-between gap-4">
                <div>
                    <div class="text-base font-semibold">Edit point</div>
                    <div class="text-xs text-slate-300">Category auto bhi reh sakti hai ya manually set bhi \u06a9\u0631
                        \u0633\u06a9\u062a\u06d2 \u06c1\u06cc\u06ba</div>
                </div> <button type="button" id="btnCloseEdit"
                    class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-medium hover:bg-slate-800">Close</button>
            </div>
            <div class="mt-4 grid grid-cols-1 gap-3 md:grid-cols-12"> <input type="hidden" id="editId" />
                <div class="md:col-span-5"> <label class="text-xs font-medium text-slate-300">Book</label> <input
                        id="editBook" required
                        class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2" />
                </div>
                <div class="md:col-span-4"> <label class="text-xs font-medium text-slate-300">Chapter</label> <input
                        id="editChapter"
                        class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2" />
                </div>
                <div class="md:col-span-3"> <label class="text-xs font-medium text-slate-300">Category</label> <select
                        id="editCategory"
                        class="mt-1 w-full rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2"></select>
                    <label class="mt-2 inline-flex items-center gap-2 text-xs text-slate-300"> <input id="editAuto"
                            type="checkbox" class="h-4 w-4 accent-indigo-500" /> Auto categorize </label> </div>
                <div class="md:col-span-12"> <label class="text-xs font-medium text-slate-300">Main point</label>
                    <textarea id="editPoint" rows="4" required
                        class="mt-1 w-full resize-y rounded-xl border border-slate-800 bg-slate-950/40 px-3 py-2 text-sm outline-none ring-indigo-500/40 focus:ring-2"></textarea>
                    <div class="mt-3 flex items-center justify-end gap-2"> <button type="button" id="btnDeleteFromEdit"
                            class="rounded-lg border border-rose-900/70 bg-rose-950/40 px-4 py-2 text-sm font-semibold text-rose-100 hover:bg-rose-950/70">Delete</button>
                        <button id="btnSaveEdit" value="default"
                            class="rounded-lg bg-indigo-500 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-400">Save
                            changes</button> </div>
                </div>
            </div>
        </form>
    </dialog> <!-- Toast -->
    <div id="toast"
        class="pointer-events-none fixed bottom-4 left-1/2 z-50 hidden -translate-x-1/2 rounded-xl border border-slate-800 bg-slate-950/90 px-4 py-3 text-sm text-slate-100 shadow-xl">
    </div>
    <script>    /**     * BookPoint     * - Store main points with book + chapter     * - Auto categorize (rule-based) + manual override     * - Search, filter, group, export/import     */    const STORAGE_KEY = 'bookpoint.v1'; const CATEGORY_DEFS = [{ id: 'Communication', color: 'indigo', keywords: ['talk', 'conversation', 'communicat', 'listen', 'speak', 'rapport', 'charisma', 'small talk', 'questions', 'social', 'baat', 'guftagu', 'sun', 'bol'] }, { id: 'Confidence', color: 'fuchsia', keywords: ['confidence', 'self-esteem', 'assertive', 'courage', 'fear', 'anxiety', 'nervous', 'shy', 'bold', 'himat'] }, { id: 'Mindset', color: 'violet', keywords: ['mindset', 'belief', 'identity', 'growth', 'attitude', 'thinking', 'thoughts', 'reframe', 'self talk', 'nazar', 'soch'] }, { id: 'Habits', color: 'emerald', keywords: ['habit', 'routine', 'discipline', 'consistency', 'daily', 'system', 'trigger', 'cue', 'reward', 'atomic'] }, { id: 'Productivity', color: 'cyan', keywords: ['productivity', 'focus', 'deep work', 'time', 'priority', 'planning', 'procrastination', 'goals', 'execution', 'deadline'] }, { id: 'Emotional Intelligence', color: 'sky', keywords: ['emotion', 'empathy', 'emotional', 'trigger', 'anger', 'calm', 'regulation', 'feelings', 'self-awareness'] }, { id: 'Relationships', color: 'pink', keywords: ['relationship', 'friend', 'trust', 'respect', 'love', 'dating', 'marriage', 'connection', 'bond', 'family'] }, { id: 'Leadership', color: 'amber', keywords: ['lead', 'leadership', 'influence', 'team', 'manager', 'delegate', 'vision', 'motivate', 'authority'] }, { id: 'Learning', color: 'lime', keywords: ['learn', 'study', 'practice', 'skill', 'memory', 'notes', 'understand', 'teach', 'feedback'] }, { id: 'Finance', color: 'green', keywords: ['money', 'finance', 'wealth', 'invest', 'saving', 'budget', 'income', 'expense'] }, { id: 'Health', color: 'teal', keywords: ['health', 'sleep', 'diet', 'exercise', 'workout', 'stress', 'breath', 'meditation', 'walk'] }, { id: 'Career', color: 'orange', keywords: ['career', 'job', 'interview', 'resume', 'work', 'promotion', 'network', 'business', 'client'] }, { id: 'General', color: 'slate', keywords: [] },]; const CATEGORY_IDS = CATEGORY_DEFS.map(c => c.id); const $ = (sel) => document.querySelector(sel); const $$ = (sel) => Array.from(document.querySelectorAll(sel)); const el = { sidebar: $('#sidebar'), btnToggleSidebar: $('#btnToggleSidebar'), sidebarSearch: $('#sidebarSearch'), mainSearch: $('#mainSearch'), statTotal: $('#statTotal'), bookList: $('#bookList'), categoryList: $('#categoryList'), btnClearBook: $('#btnClearBook'), btnClearCategory: $('#btnClearCategory'), btnClearAllFilters: $('#btnClearAllFilters'), activeFilters: $('#activeFilters'), notesContainer: $('#notesContainer'), insights: $('#insights'), suggestedCategory: $('#suggestedCategory'), selGrouping: $('#selGrouping'), selSort: $('#selSort'), btnCopySummary: $('#btnCopySummary'), addForm: $('#addForm'), inpBook: $('#inpBook'), inpChapter: $('#inpChapter'), inpPoint: $('#inpPoint'), chkAuto: $('#chkAuto'), selCategory: $('#selCategory'), btnDemo: $('#btnDemo'), btnExport: $('#btnExport'), btnExport2: $('#btnExport2'), btnImport: $('#btnImport'), btnImport2: $('#btnImport2'), btnReset: $('#btnReset'), fileImport: $('#fileImport'), editDialog: $('#editDialog'), editForm: $('#editForm'), editId: $('#editId'), editBook: $('#editBook'), editChapter: $('#editChapter'), editPoint: $('#editPoint'), editCategory: $('#editCategory'), editAuto: $('#editAuto'), btnCloseEdit: $('#btnCloseEdit'), btnDeleteFromEdit: $('#btnDeleteFromEdit'), toast: $('#toast'), }; const state = { notes: [], filters: { book: null, // string        category: null, // string        search: '',      },      grouping: 'bookChapter',      sort: 'new',    };    function uid() {      return (crypto?.randomUUID?.() || ('id_' + Math.random().toString(16).slice(2) + Date.now().toString(16)));    }    function nowISO() { return new Date().toISOString(); }    function normalize(s) {      return (s || '').toString().toLowerCase().trim();    }    function safeText(s) {      return (s || '').toString();    }    function scoreCategory(text, def) {      const s = normalize(text);      if (!s) return 0;      let score = 0;      for (const kw of def.keywords) {        const k = normalize(kw);        if (!k) continue;        // soft match by includes; slightly prefer longer keywords        if (s.includes(k)) score += Math.min(3, 1 + Math.floor(k.length / 8));      }      return score;    }    function detectCategory({ book, chapter, point }) {      const combined = [book, chapter, point].filter(Boolean).join(' \n ');      const s = normalize(combined);      // special boosts based on book title      let boosts = {};      if (s.includes('how to talk') || s.includes('talk to anyone')) boosts['Communication'] = (boosts['Communication'] || 0) + 3;      if (s.includes('atomic habits')) boosts['Habits'] = (boosts['Habits'] || 0) + 3;      if (s.includes('deep work')) boosts['Productivity'] = (boosts['Productivity'] || 0) + 3;      let best = { id: 'General', score: 0 };      for (const def of CATEGORY_DEFS) {        if (def.id === 'General') continue;        const sc = scoreCategory(combined, def) + (boosts[def.id] || 0);        if (sc > best.score) best = { id: def.id, score: sc };      }      return best.score <= 0 ? 'General' : best.id;    }    function categoryPillClasses(catId) {      const def = CATEGORY_DEFS.find(c => c.id === catId) || CATEGORY_DEFS.find(c => c.id === 'General');      const c = def?.color || 'slate';      // Tailwind browser supports arbitrary classes but keep simple      const map = {        indigo: 'bg-indigo-500/15 text-indigo-200 border-indigo-500/30',        fuchsia: 'bg-fuchsia-500/15 text-fuchsia-200 border-fuchsia-500/30',        violet: 'bg-violet-500/15 text-violet-200 border-violet-500/30',        emerald: 'bg-emerald-500/15 text-emerald-200 border-emerald-500/30',        cyan: 'bg-cyan-500/15 text-cyan-200 border-cyan-500/30',        sky: 'bg-sky-500/15 text-sky-200 border-sky-500/30',        pink: 'bg-pink-500/15 text-pink-200 border-pink-500/30',        amber: 'bg-amber-500/15 text-amber-200 border-amber-500/30',        lime: 'bg-lime-500/15 text-lime-200 border-lime-500/30',        green: 'bg-green-500/15 text-green-200 border-green-500/30',        teal: 'bg-teal-500/15 text-teal-200 border-teal-500/30',        orange: 'bg-orange-500/15 text-orange-200 border-orange-500/30',        slate: 'bg-slate-500/15 text-slate-200 border-slate-500/30',      };      return map[c] || map.slate;    }    function load() {      try {        const raw = localStorage.getItem(STORAGE_KEY);        if (!raw) return false;        const parsed = JSON.parse(raw);        if (!parsed || !Array.isArray(parsed.notes)) return false;        state.notes = parsed.notes;        state.grouping = parsed.grouping || state.grouping;        state.sort = parsed.sort || state.sort;        state.filters = { ...state.filters, ...(parsed.filters || {}) };        return true;      } catch {        return false;      }    }    function save() {      const payload = {        notes: state.notes,        grouping: state.grouping,        sort: state.sort,        filters: state.filters,        version: 1,        savedAt: nowISO(),      };      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));    }    function toast(msg) {      el.toast.textContent = msg;      el.toast.classList.remove('hidden');      el.toast.classList.add('block');      clearTimeout(toast._t);      toast._t = setTimeout(() => {        el.toast.classList.add('hidden');        el.toast.classList.remove('block');      }, 1500);    }    function setFiltersViewText() {      const parts = [];      if (state.filters.book) parts.push(`Book: ${state.filters.book}`);      if (state.filters.category) parts.push(`Category: ${state.filters.category}`);      if (state.filters.search) parts.push(`Search: \u201c${state.filters.search}\u201d`);      el.activeFilters.textContent = parts.length ? parts.join(' \u2022 ') : 'No filters';    }    function getFilteredNotes() {      const q = normalize(state.filters.search);      let notes = [...state.notes];      if (state.filters.book) {        notes = notes.filter(n => n.book === state.filters.book);      }      if (state.filters.category) {        notes = notes.filter(n => n.category === state.filters.category);      }      if (q) {        notes = notes.filter(n => {          const hay = normalize(`${n.book}\n${n.chapter || ''}\n${n.point}`);          return hay.includes(q);        });      }      // sort      if (state.sort === 'new') notes.sort((a, b) => (b.updatedAt || b.createdAt).localeCompare(a.updatedAt || a.createdAt));      if (state.sort === 'old') notes.sort((a, b) => (a.updatedAt || a.createdAt).localeCompare(b.updatedAt || b.createdAt));      if (state.sort === 'book') notes.sort((a, b) => `${a.book}`.localeCompare(`${b.book}`) || `${a.chapter || ''}`.localeCompare(`${b.chapter || ''}`));      return notes;    }    function countBy(arr, keyFn) {      const m = new Map();      for (const item of arr) {        const k = keyFn(item);        m.set(k, (m.get(k) || 0) + 1);      }      return m;    }    function renderSelectOptions(selectEl, includeAutoHint = false) {      const options = CATEGORY_IDS.map(id => `<option value="${id}">${id}</option>`).join('');      selectEl.innerHTML = options;    }    function updateSuggestedCategory() {      const book = el.inpBook.value;      const chapter = el.inpChapter.value;      const point = el.inpPoint.value;      const suggested = detectCategory({ book, chapter, point });      el.suggestedCategory.textContent = suggested;      // if auto mode, keep select in sync visually      if (el.chkAuto.checked) {        el.selCategory.value = suggested;        el.selCategory.disabled = true;        el.selCategory.classList.add('opacity-60');      } else {        el.selCategory.disabled = false;        el.selCategory.classList.remove('opacity-60');        // keep user selection as-is      }    }    function renderSidebar() {      const total = state.notes.length;      el.statTotal.textContent = `${total} point${total === 1 ? '' : 's'}`;      // Books      const bookCounts = [...countBy(state.notes, n => n.book).entries()]        .filter(([b]) => b && b.trim())        .sort((a, b) => a[0].localeCompare(b[0]));      const activeBook = state.filters.book;      el.bookList.innerHTML = bookCounts.length        ? bookCounts.map(([book, cnt]) => {            const active = activeBook === book;            return `              <button data-book="${escapeAttr(book)}" class="group flex w-full items-center justify-between rounded-xl border px-3 py-2 text-left text-sm hover:bg-slate-800/50 ${active ? 'border-indigo-500/60 bg-indigo-500/10' : 'border-slate-800 bg-slate-950/20'}">                <span class="truncate pr-2 ${active ? 'text-indigo-100' : 'text-slate-100'}">${escapeHtml(book)}</span>                <span class="rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-200">${cnt}</span>              </button>            `;          }).join('')        : `<div class="text-sm text-slate-400">No books yet. Add your first point.</div>`;      // Categories      const catCounts = [...countBy(state.notes, n => n.category || 'General').entries()]        .sort((a, b) => a[0].localeCompare(b[0]));      const activeCat = state.filters.category;      el.categoryList.innerHTML = catCounts.length        ? catCounts.map(([cat, cnt]) => {            const active = activeCat === cat;            const pillClass = categoryPillClasses(cat);            return `              <button data-category="${escapeAttr(cat)}" class="group flex w-full items-center justify-between rounded-xl border px-3 py-2 text-left text-sm hover:bg-slate-800/50 ${active ? 'border-indigo-500/60 bg-indigo-500/10' : 'border-slate-800 bg-slate-950/20'}">                <span class="inline-flex items-center gap-2 truncate pr-2">                  <span class="inline-flex items-center rounded-full border px-2 py-0.5 text-xs ${pillClass}">${escapeHtml(cat)}</span>                </span>                <span class="rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-200">${cnt}</span>              </button>            `;          }).join('')        : `<div class="text-sm text-slate-400">No categories yet.</div>`;      setFiltersViewText();    }    function renderInsights() {      if (!state.filters.book) {        el.insights.innerHTML = `<div class="text-sm text-slate-300">Kisi book ko sidebar se select karo to yahan:</div>          <ul class="mt-2 list-disc space-y-1 pl-5 text-sm text-slate-400">            <li>chapter-wise count</li>            <li>quick summary</li>            <li>copyable format</li>          </ul>`;        return;      }      const book = state.filters.book;      const bookNotes = state.notes.filter(n => n.book === book);      const chapters = [...countBy(bookNotes, n => (n.chapter && n.chapter.trim()) ? n.chapter.trim() : '(No chapter)').entries()]        .sort((a, b) => a[0].localeCompare(b[0]));      const topCats = [...countBy(bookNotes, n => n.category || 'General').entries()]        .sort((a, b) => b[1] - a[1])        .slice(0, 4);      const summaryPreview = generateSummaryText({ onlySelectedBook: true, limitPerChapter: 3 });      el.insights.innerHTML = `        <div class="rounded-xl bg-slate-950/40 p-3">          <div class="text-xs text-slate-400">Selected book</div>          <div class="mt-0.5 text-sm font-semibold">${escapeHtml(book)}</div>          <div class="mt-2 flex flex-wrap gap-2">            ${topCats.map(([cat, cnt]) => `<span class="inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs ${categoryPillClasses(cat)}"><span>${escapeHtml(cat)}</span><span class="text-slate-300">(${cnt})</span></span>`).join('')}          </div>        </div>        <div class="mt-3">          <div class="text-xs font-semibold text-slate-300">Chapters</div>          <div class="mt-2 space-y-1">            ${chapters.map(([ch, cnt]) => `              <div class="flex items-center justify-between rounded-xl border border-slate-800 bg-slate-950/20 px-3 py-2">                <div class="min-w-0">                  <div class="truncate text-sm">${escapeHtml(ch)}</div>                </div>                <div class="rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-200">${cnt}</div>              </div>            `).join('')}          </div>        </div>        <div class="mt-3">          <div class="text-xs font-semibold text-slate-300">Summary preview</div>          <pre class="mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded-xl border border-slate-800 bg-slate-950/40 p-3 text-[11px] text-slate-200 scrollbar">${escapeHtml(summaryPreview)}</pre>        </div>      `;    }    function renderNotes() {      const notes = getFilteredNotes();      if (!notes.length) {        el.notesContainer.innerHTML = `          <div class="rounded-xl border border-slate-800 bg-slate-950/20 p-4">            <div class="text-sm font-semibold">No points found</div>            <div class="mt-1 text-sm text-slate-400">Filters clear karein ya naya point add karein.</div>          </div>        `;        return;      }      if (state.grouping === 'flat') {        el.notesContainer.innerHTML = notes.map(renderNoteCard).join('');        return;      }      // Group by book -> chapter      const byBook = new Map();      for (const n of notes) {        const b = n.book || '(No book)';        if (!byBook.has(b)) byBook.set(b, []);        byBook.get(b).push(n);      }      const books = [...byBook.entries()].sort((a, b) => a[0].localeCompare(b[0]));      const html = books.map(([book, bookNotes]) => {        const byChapter = new Map();        for (const n of bookNotes) {          const ch = (n.chapter && n.chapter.trim()) ? n.chapter.trim() : '(No chapter)';          if (!byChapter.has(ch)) byChapter.set(ch, []);          byChapter.get(ch).push(n);        }        const chapters = [...byChapter.entries()].sort((a, b) => a[0].localeCompare(b[0]));        return `          <section class="mb-4">            <div class="flex items-center justify-between rounded-xl border border-slate-800 bg-slate-950/20 px-3 py-2">              <div class="min-w-0">                <div class="truncate text-sm font-semibold">${escapeHtml(book)}</div>                <div class="text-xs text-slate-400">${bookNotes.length} point${bookNotes.length === 1 ? '' : 's'}</div>              </div>              <button data-filter-book="${escapeAttr(book)}" class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-1.5 text-xs font-semibold hover:bg-slate-800">Focus</button>            </div>            <div class="mt-2 space-y-3">              ${chapters.map(([ch, chapterNotes]) => `                <div class="rounded-xl border border-slate-800 bg-slate-950/10">                  <div class="flex items-center justify-between border-b border-slate-800 px-3 py-2">                    <div class="min-w-0">                      <div class="truncate text-sm font-medium">${escapeHtml(ch)}</div>                      <div class="text-xs text-slate-400">${chapterNotes.length} note${chapterNotes.length === 1 ? '' : 's'}</div>                    </div>                    <button data-copy-chapter="${escapeAttr(book)}|||${escapeAttr(ch)}" class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-1.5 text-xs font-semibold hover:bg-slate-800">Copy</button>                  </div>                  <div class="p-3 space-y-2">                    ${chapterNotes.map(renderNoteCard).join('')}                  </div>                </div>              `).join('')}            </div>          </section>        `;      }).join('');      el.notesContainer.innerHTML = html;    }    function renderNoteCard(n) {      const cat = n.category || 'General';      const pill = categoryPillClasses(cat);      const when = new Date(n.updatedAt || n.createdAt);      const time = isNaN(when.getTime()) ? '' : when.toLocaleString([], { year: 'numeric', month: 'short', day: '2-digit' });      const autoBadge = n.auto ? `<span class="rounded-full border border-slate-700 bg-slate-900 px-2 py-0.5 text-[11px] text-slate-300">auto</span>` : '';      return `        <article class="rounded-xl border border-slate-800 bg-slate-950/20 p-3">          <div class="flex items-start justify-between gap-3">            <div class="min-w-0">              <div class="flex flex-wrap items-center gap-2">                <span class="inline-flex items-center rounded-full border px-2 py-0.5 text-xs ${pill}">${escapeHtml(cat)}</span>                ${autoBadge}                <span class="text-[11px] text-slate-400">${escapeHtml(time)}</span>              </div>              <div class="mt-2 whitespace-pre-wrap text-sm leading-relaxed text-slate-100">${escapeHtml(n.point)}</div>              <div class="mt-2 flex flex-wrap gap-2 text-[11px] text-slate-400">                <span class="rounded-full border border-slate-800 bg-slate-950/30 px-2 py-0.5">${escapeHtml(n.book)}</span>                ${n.chapter && n.chapter.trim() ? `<span class="rounded-full border border-slate-800 bg-slate-950/30 px-2 py-0.5">${escapeHtml(n.chapter)}</span>` : ''}              </div>            </div>            <div class="flex shrink-0 flex-col items-end gap-2">              <button data-edit="${escapeAttr(n.id)}" class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-1.5 text-xs font-semibold hover:bg-slate-800">Edit</button>              <button data-del="${escapeAttr(n.id)}" class="rounded-lg border border-rose-900/70 bg-rose-950/40 px-3 py-1.5 text-xs font-semibold text-rose-100 hover:bg-rose-950/70">Delete</button>            </div>          </div>        </article>      `;    }    function escapeHtml(str) {      return safeText(str)        .replaceAll('&', '&amp;')        .replaceAll('<', '&lt;')        .replaceAll('>', '&gt;')        .replaceAll('"', '&quot;')        .replaceAll("'", '&#039;');    }    function escapeAttr(str) {      // attribute-safe string      return escapeHtml(str).replaceAll('\n', ' ');    }    function rebuildInsightsAndNotes() {      renderSidebar();      renderNotes();      renderInsights();      setFiltersViewText();      save();    }    function addNote({ book, chapter, point, category, auto }) {      const n = {        id: uid(),        book: (book || '').trim() || '(Untitled book)',        chapter: (chapter || '').trim(),        point: (point || '').trim(),        category: category || 'General',        auto: !!auto,        createdAt: nowISO(),        updatedAt: nowISO(),      };      state.notes.unshift(n);      rebuildInsightsAndNotes();      toast('Saved');    }    function updateNote(id, patch) {      const idx = state.notes.findIndex(n => n.id === id);      if (idx < 0) return;      state.notes[idx] = {        ...state.notes[idx],        ...patch,        updatedAt: nowISO(),      };      rebuildInsightsAndNotes();      toast('Updated');    }    function deleteNote(id) {      const idx = state.notes.findIndex(n => n.id === id);      if (idx < 0) return;      state.notes.splice(idx, 1);      rebuildInsightsAndNotes();      toast('Deleted');    }    function clearAllFilters() {      state.filters.book = null;      state.filters.category = null;      state.filters.search = '';      el.sidebarSearch.value = '';      el.mainSearch.value = '';      rebuildInsightsAndNotes();      toast('Filters cleared');    }    function generateSummaryText({ onlySelectedBook = false, limitPerChapter = Infinity } = {}) {      const notes = onlySelectedBook && state.filters.book        ? state.notes.filter(n => n.book === state.filters.book)        : getFilteredNotes();      if (!notes.length) return 'No notes.';      // Group by book -> chapter      const byBook = new Map();      for (const n of notes) {        const b = n.book || '(No book)';        if (!byBook.has(b)) byBook.set(b, []);        byBook.get(b).push(n);      }      const lines = [];      const books = [...byBook.entries()].sort((a, b) => a[0].localeCompare(b[0]));      for (const [book, bookNotes] of books) {        lines.push(`Book: ${book}`);        const byCh = new Map();        for (const n of bookNotes) {          const ch = (n.chapter && n.chapter.trim()) ? n.chapter.trim() : '(No chapter)';          if (!byCh.has(ch)) byCh.set(ch, []);          byCh.get(ch).push(n);        }        const chapters = [...byCh.entries()].sort((a, b) => a[0].localeCompare(b[0]));        for (const [ch, chNotes] of chapters) {          lines.push(`\n  Chapter: ${ch}`);          const slice = chNotes.slice(0, limitPerChapter);          for (const n of slice) {            lines.push(`  - [${n.category || 'General'}] ${n.point.replaceAll('\n', ' ')}`);          }          if (chNotes.length > slice.length) {            lines.push(`  - \u2026 +${chNotes.length - slice.length} more`);          }        }        lines.push('\n---\n');      }      return lines.join('\n').trim();    }    async function copyToClipboard(text) {      try {        await navigator.clipboard.writeText(text);        toast('Copied');      } catch {        // fallback        const ta = document.createElement('textarea');        ta.value = text;        ta.style.position = 'fixed';        ta.style.left = '-9999px';        document.body.appendChild(ta);        ta.select();        document.execCommand('copy');        ta.remove();        toast('Copied');      }    }    function openEdit(note) {      el.editId.value = note.id;      el.editBook.value = note.book;      el.editChapter.value = note.chapter || '';      el.editPoint.value = note.point;      el.editAuto.checked = !!note.auto;      el.editCategory.value = note.category || 'General';      el.editCategory.disabled = el.editAuto.checked;      el.editCategory.classList.toggle('opacity-60', el.editAuto.checked);      el.editDialog.showModal();    }    function closeEdit() {      el.editDialog.close();    }    function ensureDemoIfEmpty() {      if (state.notes.length) return;      const demo = [        {          book: 'How to Talk to Anyone',          chapter: 'Chapter 1: First impression',          point: 'Smile early and keep open body language\u2014people decide in seconds whether you feel safe and friendly.',        },        {          book: 'How to Talk to Anyone',          chapter: 'Chapter 2: Listening',          point: 'Ask open questions, then listen for emotion + intent. Repeat a key word to encourage them to continue.',        },        {          book: 'Atomic Habits',          chapter: 'Laws of Behavior Change',          point: 'Make habits obvious, attractive, easy, and satisfying. Small systems beat big goals.',        },      ];      for (const d of demo) {        const category = detectCategory(d);        addNote({ ...d, category, auto: true });      }      toast('Demo added');    }    function wireEvents() {      // Sidebar toggle      el.btnToggleSidebar?.addEventListener('click', () => {        el.sidebar.classList.toggle('hidden');      });      // Keep sidebar visible on md+      const mq = window.matchMedia('(min-width: 768px)');      const syncSidebar = () => {        if (mq.matches) el.sidebar.classList.remove('hidden');      };      mq.addEventListener?.('change', syncSidebar);      syncSidebar();      // Form: category options      renderSelectOptions(el.selCategory);      renderSelectOptions(el.editCategory);      el.chkAuto.addEventListener('change', updateSuggestedCategory);      ['input', 'change'].forEach(evt => {        el.inpBook.addEventListener(evt, updateSuggestedCategory);        el.inpChapter.addEventListener(evt, updateSuggestedCategory);        el.inpPoint.addEventListener(evt, updateSuggestedCategory);      });      el.addForm.addEventListener('submit', (e) => {        e.preventDefault();        const book = el.inpBook.value;        const chapter = el.inpChapter.value;        const point = el.inpPoint.value;        if (!book.trim() || !point.trim()) {          toast('Book and point required');          return;        }        const suggested = detectCategory({ book, chapter, point });        const auto = el.chkAuto.checked;        const category = auto ? suggested : el.selCategory.value;        addNote({ book, chapter, point, category, auto });        el.inpPoint.value = '';        updateSuggestedCategory();        el.inpPoint.focus();      });      // Ctrl/\u2318 + Enter to submit      el.inpPoint.addEventListener('keydown', (e) => {        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {          el.addForm.requestSubmit();        }      });      el.btnDemo.addEventListener('click', () => {        ensureDemoIfEmpty();      });      // Filters/search      const onSearchChanged = (value) => {        state.filters.search = value;        rebuildInsightsAndNotes();      };      const debounced = debounce(onSearchChanged, 150);      el.sidebarSearch.addEventListener('input', (e) => {        el.mainSearch.value = e.target.value;        debounced(e.target.value);      });      el.mainSearch.addEventListener('input', (e) => {        el.sidebarSearch.value = e.target.value;        debounced(e.target.value);      });      el.btnClearBook.addEventListener('click', () => {        state.filters.book = null;        rebuildInsightsAndNotes();      });      el.btnClearCategory.addEventListener('click', () => {        state.filters.category = null;        rebuildInsightsAndNotes();      });      el.btnClearAllFilters.addEventListener('click', clearAllFilters);      el.selGrouping.addEventListener('change', (e) => {        state.grouping = e.target.value;        rebuildInsightsAndNotes();      });      el.selSort.addEventListener('change', (e) => {        state.sort = e.target.value;        rebuildInsightsAndNotes();      });      // Copy summary      el.btnCopySummary.addEventListener('click', () => {        const txt = generateSummaryText({ onlySelectedBook: !!state.filters.book });        copyToClipboard(txt);      });      // Export/Import      const doExport = () => {        const payload = {          exportedAt: nowISO(),          app: 'BookPoint',          version: 1,          notes: state.notes,        };        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });        const a = document.createElement('a');        a.href = URL.createObjectURL(blob);        a.download = `bookpoint-backup-${new Date().toISOString().slice(0,10)}.json`;        document.body.appendChild(a);        a.click();        a.remove();        setTimeout(() => URL.revokeObjectURL(a.href), 500);        toast('Exported');      };      const openImport = () => el.fileImport.click();      el.btnExport.addEventListener('click', doExport);      el.btnExport2.addEventListener('click', doExport);      el.btnImport.addEventListener('click', openImport);      el.btnImport2.addEventListener('click', openImport);      el.fileImport.addEventListener('change', async (e) => {        const file = e.target.files?.[0];        if (!file) return;        try {          const text = await file.text();          const parsed = JSON.parse(text);          const imported = Array.isArray(parsed?.notes) ? parsed.notes : (Array.isArray(parsed) ? parsed : null);          if (!imported) throw new Error('Invalid file');          // Normalize/validate          const cleaned = imported            .filter(n => n && n.point && n.book)            .map(n => ({              id: n.id || uid(),              book: (n.book || '').trim() || '(Untitled book)',              chapter: (n.chapter || '').trim(),              point: (n.point || '').trim(),              category: (n.category && CATEGORY_IDS.includes(n.category)) ? n.category : detectCategory(n),              auto: !!n.auto,              createdAt: n.createdAt || nowISO(),              updatedAt: n.updatedAt || n.createdAt || nowISO(),            }));          // Merge by id (avoid duplicates)          const existingIds = new Set(state.notes.map(n => n.id));          const toAdd = cleaned.filter(n => !existingIds.has(n.id));          state.notes = [...toAdd, ...state.notes];          rebuildInsightsAndNotes();          toast(`Imported ${toAdd.length}`);        } catch {          toast('Import failed');        } finally {          el.fileImport.value = '';        }      });      // Reset      el.btnReset.addEventListener('click', () => {        const ok = confirm('Reset: This will delete all saved points from this browser. Continue?');        if (!ok) return;        state.notes = [];        clearAllFilters();        localStorage.removeItem(STORAGE_KEY);        rebuildInsightsAndNotes();        toast('Reset done');      });      // Notes container delegation      el.notesContainer.addEventListener('click', (e) => {        const t = e.target.closest('button');        if (!t) return;        if (t.dataset.edit) {          const note = state.notes.find(n => n.id === t.dataset.edit);          if (note) openEdit(note);        }        if (t.dataset.del) {          const id = t.dataset.del;          const ok = confirm('Delete this note?');          if (ok) deleteNote(id);        }        if (t.dataset.filterBook) {          state.filters.book = t.dataset.filterBook;          rebuildInsightsAndNotes();          toast('Book filter applied');        }        if (t.dataset.copyChapter) {          const [book, ch] = t.dataset.copyChapter.split('|||');          const chapterNotes = state.notes.filter(n => n.book === book && ((n.chapter || '(No chapter)').trim() || '(No chapter)') === ch);          const lines = [];          lines.push(`Book: ${book}`);          lines.push(`Chapter: ${ch}`);          for (const n of chapterNotes) lines.push(`- [${n.category || 'General'}] ${n.point.replaceAll('\n', ' ')}`);          copyToClipboard(lines.join('\n'));        }      });      // Sidebar lists delegation      el.bookList.addEventListener('click', (e) => {        const btn = e.target.closest('button[data-book]');        if (!btn) return;        const b = btn.dataset.book;        state.filters.book = b;        rebuildInsightsAndNotes();        toast('Book selected');      });      el.categoryList.addEventListener('click', (e) => {        const btn = e.target.closest('button[data-category]');        if (!btn) return;        const c = btn.dataset.category;        state.filters.category = c;        rebuildInsightsAndNotes();        toast('Category selected');      });      // Edit dialog      el.btnCloseEdit.addEventListener('click', closeEdit);      el.editAuto.addEventListener('change', () => {        el.editCategory.disabled = el.editAuto.checked;        el.editCategory.classList.toggle('opacity-60', el.editAuto.checked);        if (el.editAuto.checked) {          const cat = detectCategory({ book: el.editBook.value, chapter: el.editChapter.value, point: el.editPoint.value });          el.editCategory.value = cat;        }      });      // Keep suggested category updated in edit when auto      ['input', 'change'].forEach(evt => {        el.editBook.addEventListener(evt, () => {          if (!el.editAuto.checked) return;          el.editCategory.value = detectCategory({ book: el.editBook.value, chapter: el.editChapter.value, point: el.editPoint.value });        });        el.editChapter.addEventListener(evt, () => {          if (!el.editAuto.checked) return;          el.editCategory.value = detectCategory({ book: el.editBook.value, chapter: el.editChapter.value, point: el.editPoint.value });        });        el.editPoint.addEventListener(evt, () => {          if (!el.editAuto.checked) return;          el.editCategory.value = detectCategory({ book: el.editBook.value, chapter: el.editChapter.value, point: el.editPoint.value });        });      });      el.editForm.addEventListener('submit', (e) => {        e.preventDefault();        const id = el.editId.value;        const book = el.editBook.value;        const chapter = el.editChapter.value;        const point = el.editPoint.value;        const auto = el.editAuto.checked;        const category = auto ? detectCategory({ book, chapter, point }) : el.editCategory.value;        updateNote(id, { book: book.trim() || '(Untitled book)', chapter: chapter.trim(), point: point.trim(), category, auto });        closeEdit();      });      el.btnDeleteFromEdit.addEventListener('click', () => {        const id = el.editId.value;        const ok = confirm('Delete this note?');        if (!ok) return;        closeEdit();        deleteNote(id);      });      // Initial form suggestion      updateSuggestedCategory();      // Initial state into UI      el.selGrouping.value = state.grouping;      el.selSort.value = state.sort;    }    function debounce(fn, ms) {      let t = null;      return (...args) => {        clearTimeout(t);        t = setTimeout(() => fn(...args), ms);      };    }    function init() {      const had = load();      wireEvents();      rebuildInsightsAndNotes();      // If no saved data, keep empty but user can add demo.      if (!had && state.notes.length === 0) {        // subtle hint (no blocking)        setTimeout(() => toast('Tip: \u201cAdd demo\u201d try karein'), 600);      }    }    init();  </script>
</body>

</html>